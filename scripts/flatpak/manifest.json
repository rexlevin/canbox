{
    "app-id": "com.github.lizl6.canbox",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "canbox-launcher",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--share=network",
        "--device=dri",
        "--filesystem=home",
        "--filesystem=xdg-documents",
        "--filesystem=xdg-download",
        "--talk-name=org.freedesktop.Notifications",
        "--own-name=com.github.lizl6.canbox"
    ],
    "modules": [
        {
            "name": "canbox",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "dir",
                    "path": "../../dist/linux-unpacked",
                    "dest": "canbox-src"
                },
                {
                    "type": "file",
                    "path": "../../logo_512x512.png",
                    "dest-filename": "logo_512x512.png"
                },
                {
                    "type": "file",
                    "path": "../../logo_256x256.png",
                    "dest-filename": "logo_256x256.png"
                },
                {
                    "type": "file",
                    "path": "../../logo_128x128.png",
                    "dest-filename": "logo_128x128.png"
                },
                {
                    "type": "dir",
                    "path": "../../docs",
                    "dest": "docs-src"
                }
            ],
            "build-commands": [
                "mkdir -p /app/bin",
                "cat > /app/bin/canbox-launcher << 'EOF'\n#!/bin/bash\nexec /app/bin/canbox --no-sandbox \"$@\"\nEOF",
                "chmod +x /app/bin/canbox-launcher",
                "install -Dm755 canbox-src/canbox /app/bin/canbox",
                "install -Dm755 canbox-src/chrome_crashpad_handler /app/bin/",
                "install -Dm755 canbox-src/chrome-sandbox /app/bin/",
                "cp -r canbox-src/resources /app/bin/",
                "cp -r canbox-src/locales /app/bin/",
                "cp canbox-src/*.pak /app/bin/ 2>/dev/null || true",
                "cp canbox-src/*.dat /app/bin/ 2>/dev/null || true",
                "cp canbox-src/*.bin /app/bin/ 2>/dev/null || true",
                "cp canbox-src/*.so* /app/bin/ 2>/dev/null || true",
                "cp canbox-src/*.json /app/bin/ 2>/dev/null || true",
                "cp canbox-src/*.html /app/bin/ 2>/dev/null || true",
                "mkdir -p /app/bin/docs",
                "install -m644 docs-src/APP_DEV_CN.md /app/bin/docs/APP_DEV_CN.md",
                "install -m644 docs-src/API_CN.md /app/bin/docs/API_CN.md",
                "mkdir -p /app/share/icons/hicolor/512x512/apps",
                "mkdir -p /app/share/icons/hicolor/256x256/apps",
                "mkdir -p /app/share/icons/hicolor/128x128/apps",
                "install -Dm644 logo_512x512.png /app/share/icons/hicolor/512x512/apps/com.github.lizl6.canbox.png",
                "install -Dm644 logo_256x256.png /app/share/icons/hicolor/256x256/apps/com.github.lizl6.canbox.png",
                "install -Dm644 logo_128x128.png /app/share/icons/hicolor/128x128/apps/com.github.lizl6.canbox.png",
                "mkdir -p /app/share/applications",
                "cat > com.github.lizl6.canbox.desktop << 'EOF'\n[Desktop Entry]\nVersion=1.0\nType=Application\nName=Canbox\nGenericName=Application Management Tool\nComment=Some useful apps you need for your life\nExec=canbox-launcher\nIcon=com.github.lizl6.canbox\nCategories=Utility;System\nTerminal=false\nStartupWMClass=canbox\nMimeType=\nEOF",
                "install -Dm644 com.github.lizl6.canbox.desktop /app/share/applications/com.github.lizl6.canbox.desktop",
                "rm -f com.github.lizl6.canbox.desktop",
                "rm -rf canbox-src"
            ]
        }
    ]
}